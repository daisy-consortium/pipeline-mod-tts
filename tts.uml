@startuml

"[A] dtbook-to-daisy3" -->[enriched dtbook + sentence ids + skippable ids] "dtbook-to-ssml (XProc)"
-->[enriched dtbook + sentence ids + skippable ids] "make dtbook-specific transformations (XProc)"

partition "Generic text-to-ssml (XProc)" {

-->[dtbook + sentence ids + dtbook parameters] "insert SSML sentences and tokens"
-->[dtbook mixed with SSML] "add user's annotations (text around elts)"
-->[dtbook mixed with SSML] "project CSS onto sentences"
-->[list of dtbook-SSML sentences + skippable ids] "extract skippable elements and insert SSML marks"
-->[.] ===B1===

===B1=== -->[skippable-only sentences] "[A] extract MathML"
--> ===B3===

===B3=== -->[.] "group skippable elements"
-->[.] "[B]convert CSS to SSML"
-->[SSML file] ==B2==

===B1=== -->[skippable-free sentences] "[B] extract MathML"
--> ===B4===

===B4=== -->[.] "[A]convert CSS to SSML"
-->[.] "Make substitutions with lexicons"
-->[.] "Remove anything outside tokens"
-->[SSML file] ===B2===

===B4=== -->[MathML] "MathML to SSML"
===B3=== -->[MathML] "MathML to SSML"
-->[.] "[C] convert CSS to SSML"
-->[SSML file] ===B2===

===B2=== -->[SSML files] "Reorder in document order"

}

-->[SSML file(s)] "ssml-to-audio (Java)"
-->[Map of @id to audio files] "[B] dtbook-to-daisy3"

@enduml